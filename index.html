<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Rolling Journal">
    <meta name="theme-color" content="#c44536">
    <meta name="description" content="Din BJJ-utveckling, systematiskt dokumenterad">
    <title>Rolling Journal LITE</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" sizes="192x192" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23c44536' width='100' height='100'/><text y='75' x='50' text-anchor='middle' font-size='60' fill='%23faf8f5'>ü•ã</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%23c44536' width='100' height='100'/><text y='75' x='50' text-anchor='middle' font-size='60' fill='%23faf8f5'>ü•ã</text></svg>">
    
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@300;400;600;700&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
    
    <style>
        :root {
            --ink: #1a1a1a;
            --paper: #faf8f5;
            --accent: #c44536;
            --subtle: #8b8680;
            --line: #e5e1da;
            --shadow: rgba(0,0,0,0.08);
            --success: #2d7a3e;
            --warning: #d97706;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Crimson Pro', serif;
            background: var(--paper);
            color: var(--ink);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
        }

        header {
            border-bottom: 2px solid var(--ink);
            padding-bottom: 1.5rem;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            color: var(--subtle);
            font-size: 1.1rem;
            font-weight: 300;
        }

        .nav {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--line);
            padding-top: 1rem;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: none;
            border: none;
            font-family: 'DM Mono', monospace;
            font-size: 0.9rem;
            color: var(--subtle);
            cursor: pointer;
            padding: 0.5rem 1rem;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .nav-btn.active {
            color: var(--paper);
            background: var(--accent);
        }

        .nav-btn:hover {
            color: var(--ink);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 2rem;
            position: relative;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1rem;
        }

        label {
            display: block;
            font-family: 'DM Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            color: var(--subtle);
        }

        label .optional {
            color: var(--line);
            text-transform: lowercase;
            font-size: 0.75rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--line);
            background: white;
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            color: var(--ink);
            transition: all 0.2s;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(196, 69, 54, 0.1);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
            line-height: 1.5;
        }

        .voice-input-wrapper {
            position: relative;
        }

        .voice-btn {
            position: absolute;
            right: 0.5rem;
            top: 0.5rem;
            background: var(--accent);
            color: white;
            border: none;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1.2rem;
        }

        .voice-btn:hover {
            background: #a33828;
            transform: scale(1.05);
        }

        .voice-btn.recording {
            background: #ff4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .btn {
            background: var(--ink);
            color: var(--paper);
            border: none;
            padding: 1rem 2rem;
            font-family: 'DM Mono', monospace;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            margin-top: 1rem;
        }

        .btn:hover {
            background: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        .btn-secondary {
            background: white;
            color: var(--ink);
            border: 1px solid var(--line);
        }

        .btn-secondary:hover {
            background: var(--paper);
            border-color: var(--accent);
        }

        .weight-input-group {
            display: flex;
            align-items: flex-end;
            gap: 0.5rem;
        }

        .weight-input-group input {
            flex: 1;
        }

        .weight-unit {
            font-family: 'DM Mono', monospace;
            color: var(--subtle);
            padding-bottom: 0.75rem;
            font-size: 0.9rem;
        }

        .weight-status {
            display: inline-block;
            padding: 0.4rem 0.8rem;
            border-radius: 2px;
            font-family: 'DM Mono', monospace;
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .weight-status.good {
            background: rgba(45, 122, 62, 0.1);
            color: var(--success);
        }

        .weight-status.warning {
            background: rgba(217, 119, 6, 0.1);
            color: var(--warning);
        }

        .weight-status.danger {
            background: rgba(220, 38, 38, 0.1);
            color: #dc2626;
        }

        .entry-card {
            border: 1px solid var(--line);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background: white;
            transition: all 0.2s;
        }

        .entry-card:hover {
            box-shadow: 0 4px 20px var(--shadow);
            transform: translateY(-2px);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--line);
        }

        .entry-date {
            font-family: 'DM Mono', monospace;
            font-size: 0.9rem;
            color: var(--accent);
            font-weight: 500;
        }

        .entry-meta {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .entry-coach {
            font-family: 'DM Mono', monospace;
            font-size: 0.75rem;
            text-transform: uppercase;
            color: var(--subtle);
            letter-spacing: 0.05em;
        }

        .entry-weight {
            font-family: 'DM Mono', monospace;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--ink);
        }

        .entry-content h4 {
            font-size: 0.85rem;
            font-family: 'DM Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--subtle);
            margin-top: 1rem;
            margin-bottom: 0.5rem;
        }

        .entry-content p {
            margin-bottom: 0.75rem;
            line-height: 1.6;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border: 1px solid var(--line);
            padding: 1.5rem;
            text-align: center;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent);
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-family: 'DM Mono', monospace;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--subtle);
        }

        .chart-container {
            background: white;
            border: 1px solid var(--line);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .chart-container h3 {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
            font-family: 'DM Mono', monospace;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .pattern-list {
            background: white;
            border: 1px solid var(--line);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .pattern-list h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--line);
        }

        .pattern-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--line);
        }

        .pattern-item:last-child {
            border-bottom: none;
        }

        .pattern-name {
            font-weight: 500;
        }

        .pattern-count {
            font-family: 'DM Mono', monospace;
            color: var(--accent);
            font-weight: 500;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--subtle);
        }

        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--ink);
        }

        .delete-btn {
            background: transparent;
            border: 1px solid var(--line);
            color: var(--subtle);
            padding: 0.5rem 1rem;
            font-family: 'DM Mono', monospace;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .delete-btn:hover {
            background: #ff4444;
            color: white;
            border-color: #ff4444;
        }

        .success-message {
            background: rgba(45, 122, 62, 0.1);
            color: var(--success);
            padding: 1rem;
            border-left: 3px solid var(--success);
            margin-bottom: 1rem;
            font-family: 'DM Mono', monospace;
            font-size: 0.9rem;
        }

        .agame-section {
            background: white;
            border: 2px solid var(--accent);
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .agame-section h3 {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: var(--accent);
        }

        .agame-position {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--line);
        }

        .agame-position:last-child {
            border-bottom: none;
        }

        .agame-position h4 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .agame-position ul {
            list-style: none;
            padding-left: 0;
        }

        .agame-position li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .agame-position li:before {
            content: "‚Üí";
            position: absolute;
            left: 0;
            color: var(--accent);
            font-weight: bold;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .nav {
                gap: 0.5rem;
            }

            .nav-btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        .hidden {
            display: none !important;
        }

        .motivation-dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 1.5rem;
            align-items: center;
        }

        .motivation-stats {
            text-align: center;
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--accent), #a33828);
            color: white;
            border-radius: 4px;
        }

        .motivation-stats .big-number {
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .motivation-stats .stat-label {
            font-family: 'DM Mono', monospace;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            opacity: 0.9;
        }

        .motivation-message {
            padding: 1.5rem;
        }

        .motivation-message h3 {
            font-size: 1.5rem;
            margin-bottom: 0.75rem;
            color: var(--accent);
        }

        .motivation-message p {
            font-size: 1.1rem;
            line-height: 1.6;
            color: var(--ink);
        }

        .motivation-message .emoji {
            font-size: 2rem;
            margin-right: 0.5rem;
        }

        @media (max-width: 768px) {
            .motivation-dashboard {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Rolling Journal</h1>
            <p class="subtitle">Din BJJ-utveckling, systematiskt dokumenterad</p>
            
            <div class="nav">
                <button class="nav-btn active" onclick="showSection('log')">Ny Logg</button>
                <button class="nav-btn" onclick="showSection('entries')">Alla Pass</button>
                <button class="nav-btn" onclick="showSection('teknikbank')">Teknikbank</button>
                <button class="nav-btn" onclick="showSection('roadmap')">B√§ltes Roadmap</button>
                <button class="nav-btn" onclick="showSection('weight')">Vikt</button>
                <button class="nav-btn" onclick="showSection('weekly')">Veckosammanfattning</button>
                <button class="nav-btn" onclick="showSection('analysis')">Analys</button>
                <button class="nav-btn" onclick="showSection('agame')">A-Spel</button>
                <button class="nav-btn" onclick="showSection('export')">Backup</button>
            </div>
        </header>

        <!-- LOG ENTRY SECTION -->
        <section id="log" class="section active">
            <!-- Motivation Dashboard -->
            <div id="motivationDashboard" class="pattern-list" style="margin-bottom: 2rem;"></div>
            
            <div id="logMessage" class="success-message hidden"></div>
            <form id="logForm">
                <div class="form-group">
                    <label for="date">Datum</label>
                    <input type="date" id="date" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="coach">Coach <span class="optional">valfritt</span></label>
                        <select id="coach">
                            <option value="">V√§lj coach</option>
                            <option value="Josh">Josh</option>
                            <option value="Hermes">Hermes</option>
                            <option value="Henry">Henry</option>
                            <option value="Marffy">Marffy</option>
                            <option value="annan">Annan</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="weight">Vikt (kg) <span class="optional">valfritt</span></label>
                        <div class="weight-input-group">
                            <input type="number" id="weight" step="0.1" min="50" max="150" placeholder="79.5">
                            <span class="weight-unit">kg</span>
                        </div>
                        <div id="weightStatus"></div>
                    </div>
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="technique">Teknik som tr√§nades</label>
                    <textarea id="technique" placeholder="Vilka positioner/√∂verg√•ngar/submissions jobbade ni med?"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('technique')" title="R√∂stinspelning">üé§</button>
                </div>

                <div class="form-group">
                    <label for="rolls">Antal rullar / partners</label>
                    <input type="text" id="rolls" placeholder="t.ex. 5 rullar, 3 olika partners">
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="positions">Positioner jag hamnade i mest</label>
                    <textarea id="positions" placeholder="Vilka positioner √•terkom?"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('positions')" title="R√∂stinspelning">üé§</button>
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="worked">Vad fungerade</label>
                    <textarea id="worked" placeholder="Tekniker, √∂verg√•ngar eller strategier som lyckades"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('worked')" title="R√∂stinspelning">üé§</button>
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="stuck">Vad fungerade inte</label>
                    <textarea id="stuck" placeholder="Vad funkade inte? Var f√∂rlorade du position?"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('stuck')" title="R√∂stinspelning">üé§</button>
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="good">‚úÖ En sak som k√§ndes bra</label>
                    <textarea id="good" placeholder="En positiv observation"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('good')" title="R√∂stinspelning">üé§</button>
                </div>

                <div class="form-group voice-input-wrapper">
                    <label for="improve">üéØ En sak att jobba p√• n√§sta pass</label>
                    <textarea id="improve" placeholder="Konkret sak att fokusera p√•"></textarea>
                    <button type="button" class="voice-btn" onclick="startVoice('improve')" title="R√∂stinspelning">üé§</button>
                </div>

                <button type="submit" class="btn">Spara Pass</button>
            </form>
        </section>

        <!-- ALL ENTRIES SECTION -->
        <section id="entries" class="section">
            <div id="entriesList"></div>
        </section>

        <!-- TEKNIKBANK SECTION -->
        <section id="teknikbank" class="section">
            <div class="pattern-list" style="margin-bottom: 2rem;">
                <h3>L√§gg till nytt tips</h3>
                <form id="tipForm" style="margin-top: 1rem;">
                    <div class="form-group">
                        <label for="tipTitle">Teknik/Position</label>
                        <input type="text" id="tipTitle" placeholder="t.ex. Mount Escape, Triangle fr√•n Guard..." required>
                    </div>
                    <div class="form-group">
                        <label for="tipContent">Tips/L√§rdomar</label>
                        <textarea id="tipContent" rows="4" placeholder="Beskriv tekniken, vad coach sa, viktig detalj..." required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipCategory">Kategori</label>
                            <select id="tipCategory">
                                <option value="guard">Guard</option>
                                <option value="passing">Guard Passing</option>
                                <option value="mount">Mount</option>
                                <option value="side-control">Side Control</option>
                                <option value="back">Back Control</option>
                                <option value="escape">Escapes</option>
                                <option value="submission">Submissions</option>
                                <option value="sweep">Sweeps</option>
                                <option value="takedown">Takedowns</option>
                                <option value="general">Allm√§nt</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tipFavorite">
                                <input type="checkbox" id="tipFavorite" style="width: auto; margin-right: 0.5rem;">
                                Favorit ‚≠ê
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="btn">Spara Tips</button>
                </form>
            </div>

            <div class="pattern-list">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3>Mina Tips & Tekniker</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="tipSearch" placeholder="S√∂k..." style="width: 200px; padding: 0.5rem;">
                        <select id="tipFilter" style="width: 150px; padding: 0.5rem;">
                            <option value="all">Alla</option>
                            <option value="favorites">‚≠ê Favoriter</option>
                            <option value="guard">Guard</option>
                            <option value="passing">Passing</option>
                            <option value="mount">Mount</option>
                            <option value="side-control">Side Control</option>
                            <option value="back">Back</option>
                            <option value="escape">Escapes</option>
                            <option value="submission">Submissions</option>
                            <option value="sweep">Sweeps</option>
                            <option value="takedown">Takedowns</option>
                            <option value="general">Allm√§nt</option>
                        </select>
                    </div>
                </div>
                <div id="tipsList"></div>
            </div>
        </section>

        <!-- BELT ROADMAP SECTION -->
        <section id="roadmap" class="section">
            <div class="pattern-list" style="margin-bottom: 2rem; background: linear-gradient(135deg, #f5f5f5, #faf8f5); border: 2px solid var(--ink);">
                <h3 style="font-size: 1.8rem; margin-bottom: 1rem;">ü•ã Din BJJ Resa</h3>
                <p style="color: var(--subtle); margin-bottom: 1rem;">
                    Roadmap baserad p√• IBJJF standards och typisk progression. Anv√§nd detta som en guide - alla utvecklas i olika takt!
                </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1.5rem;">
                    <div style="text-align: center; padding: 1rem; background: white; border: 2px solid #ddd;">
                        <div style="font-size: 2rem;">‚ö™</div>
                        <div style="font-weight: 600;">Vitt B√§lte</div>
                        <div style="font-size: 0.85rem; color: var(--subtle);">6-12 m√•n</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border: 2px solid #3b82f6;">
                        <div style="font-size: 2rem;">üîµ</div>
                        <div style="font-weight: 600;">Bl√•tt B√§lte</div>
                        <div style="font-size: 0.85rem; color: var(--subtle);">2-3 √•r</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border: 2px solid #8b5cf6;">
                        <div style="font-size: 2rem;">üü£</div>
                        <div style="font-weight: 600;">Lila B√§lte</div>
                        <div style="font-size: 0.85rem; color: var(--subtle);">4-5 √•r</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border: 2px solid #92400e;">
                        <div style="font-size: 2rem;">üü§</div>
                        <div style="font-weight: 600;">Brunt B√§lte</div>
                        <div style="font-size: 0.85rem; color: var(--subtle);">6-7 √•r</div>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: white; border: 2px solid #000;">
                        <div style="font-size: 2rem;">‚ö´</div>
                        <div style="font-weight: 600;">Svart B√§lte</div>
                        <div style="font-size: 0.85rem; color: var(--subtle);">8-10+ √•r</div>
                    </div>
                </div>
            </div>

            <!-- White Belt -->
            <div class="agame-section" style="border-color: #ddd;">
                <h3 style="color: #666;">‚ö™ VITT B√ÑLTE (0-12 m√•nader)</h3>
                <p style="color: var(--subtle); margin-bottom: 2rem;">
                    <strong>M√•l:</strong> √ñverleva, l√§ra grunderna, bli bekv√§m med sparring. F√∂rst√• att BJJ √§r ett schackspel, inte brottning.
                </p>

                <div class="agame-position">
                    <h4>üõ°Ô∏è Escapes (Viktigast f√∂r nyb√∂rjare!)</h4>
                    <ul>
                        <li>Mount escape - elbow escape (shrimp ut)</li>
                        <li>Side control escape - frame och hip escape</li>
                        <li>Back escape - hand fighting och chin tuck</li>
                        <li>Headlock escape</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üéØ Positionell Kontroll</h4>
                    <ul>
                        <li>Closed guard - h√•ll och kontrollera</li>
                        <li>Mount - h√•ll position, f√∂rst√• viktf√∂rdelning</li>
                        <li>Side control - basic kontroll</li>
                        <li>Back control - hooks in, seat belt grip</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üí™ Grundl√§ggande Submissions</h4>
                    <ul>
                        <li>Armbar fr√•n mount och guard</li>
                        <li>Triangle fr√•n guard</li>
                        <li>Rear naked choke fr√•n back</li>
                        <li>Americana fr√•n side control/mount</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>ü•ã Guard Passing (Basic)</h4>
                    <ul>
                        <li>Toreando pass (bull fighter)</li>
                        <li>Knee slice pass</li>
                        <li>Basic pressure passing</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üìö Koncept att f√∂rst√•</h4>
                    <ul>
                        <li>Position f√∂re submission</li>
                        <li>Frames och hip escape movement</li>
                        <li>Base och posture</li>
                        <li>Breathing och energi-hantering</li>
                        <li>Tapping tidigt och ofta</li>
                    </ul>
                </div>
            </div>

            <!-- Blue Belt -->
            <div class="agame-section" style="border-color: #3b82f6;">
                <h3 style="color: #3b82f6;">üîµ BL√ÖTT B√ÑLTE (1-3 √•r)</h3>
                <p style="color: var(--subtle); margin-bottom: 2rem;">
                    <strong>M√•l:</strong> Bygg ditt A-game. Utveckla fungerande guard, reliable escapes, och en submission-kedja.
                </p>

                <div class="agame-position">
                    <h4>üéÆ Guard Game</h4>
                    <ul>
                        <li>En prim√§r open guard (butterfly, spider, DLR, eller half guard)</li>
                        <li>Guard retention fundamentals</li>
                        <li>Sweeps fr√•n din prim√§ra guard (3-5 stycken)</li>
                        <li>Back takes fr√•n guard</li>
                        <li>Triangle, armbar, omoplata system</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>‚öîÔ∏è Guard Passing (Utvecklad)</h4>
                    <ul>
                        <li>Pressure passing system</li>
                        <li>Float/movement passing</li>
                        <li>Knee cut variations</li>
                        <li>Leg drag pass</li>
                        <li>Stack pass</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üîó Submission Chains</h4>
                    <ul>
                        <li>Mount: armbar ‚Üí triangle ‚Üí take back</li>
                        <li>Side: kimura ‚Üí armbar ‚Üí back</li>
                        <li>Back: RNC ‚Üí armbar crossface</li>
                        <li>Guard: triangle ‚Üí omoplata ‚Üí sweep</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>ü•ä Takedowns</h4>
                    <ul>
                        <li>Basic double leg</li>
                        <li>Single leg variations</li>
                        <li>Snap down to front headlock</li>
                        <li>Guard pull (technical)</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üìö Koncept</h4>
                    <ul>
                        <li>Inside space control</li>
                        <li>Grips och grip fighting</li>
                        <li>Pressure vs connection</li>
                        <li>Angle creation</li>
                        <li>Chain wrestling (position ‚Üí position)</li>
                    </ul>
                </div>
            </div>

            <!-- Purple Belt Preview -->
            <div class="agame-section" style="border-color: #8b5cf6;">
                <h3 style="color: #8b5cf6;">üü£ LILA B√ÑLTE (3-5 √•r)</h3>
                <p style="color: var(--subtle); margin-bottom: 2rem;">
                    <strong>M√•l:</strong> Refinement. Ditt BJJ blir personligt. Du b√∂rjar undervisa andra.
                </p>

                <div class="agame-position">
                    <h4>üéØ Specialisering</h4>
                    <ul>
                        <li>Master din prim√§ra guard fullst√§ndigt</li>
                        <li>Utveckla en sekund√§r guard f√∂r variation</li>
                        <li>Half guard - b√•de top och bottom</li>
                        <li>Leg lock fundamentals (om till√•tet)</li>
                        <li>Advanced back attacks</li>
                    </ul>
                </div>

                <div class="agame-position">
                    <h4>üß† Mental Game</h4>
                    <ul>
                        <li>Reads och anticipation</li>
                        <li>Pacing och energy management</li>
                        <li>Competition strategy</li>
                        <li>Teaching ability</li>
                    </ul>
                </div>
            </div>

            <div style="margin-top: 2rem; padding: 1.5rem; background: var(--paper); border-left: 3px solid var(--accent);">
                <h4 style="margin-bottom: 1rem;">üí° Tips f√∂r progression:</h4>
                <ul style="line-height: 1.8;">
                    <li><strong>Fokusera p√• escapes f√∂rst</strong> - Du kommer hamna i d√•liga positioner. L√§r dig ta dig ut.</li>
                    <li><strong>Bygg ett A-spel</strong> - 3-5 tekniker som funkar VERKLIGEN f√∂r dig √§r b√§ttre √§n 50 som funkar ibland.</li>
                    <li><strong>Roll med alla</strong> - St√∂rre, mindre, b√§ttre, s√§mre. Varje partner l√§r dig n√•got unikt.</li>
                    <li><strong>T√§vla minst en g√•ng</strong> - √Ñven om du f√∂rlorar, du l√§r dig mer p√• 5 min √§n 5 veckor tr√§ning.</li>
                    <li><strong>Var konsekvent</strong> - 3x/vecka i 5 √•r sl√•r 6x/vecka i 6 m√•nader.</li>
                    <li><strong>Fr√•ga efter rullning</strong> - "Vad funkade? Vad borde jag jobba p√•?"</li>
                </ul>
            </div>
        </section>

        <!-- WEIGHT TRACKING SECTION -->
        <section id="weight" class="section">
            <div class="chart-container">
                <h3>Viktutveckling</h3>
                <canvas id="weightChart"></canvas>
            </div>
            <div id="weightStats" class="stats-grid"></div>
        </section>

        <!-- WEEKLY SUMMARY SECTION -->
        <section id="weekly" class="section">
            <div id="weeklyContent"></div>
        </section>

        <!-- ANALYSIS SECTION -->
        <section id="analysis" class="section">
            <div class="stats-grid" id="statsGrid"></div>
            <div id="patternsContainer"></div>
        </section>

        <!-- A-GAME SECTION -->
        <section id="agame" class="section">
            <div id="agameContent"></div>
        </section>

        <!-- EXPORT/BACKUP SECTION -->
        <section id="export" class="section">
            <div class="pattern-list">
                <h3>Exportera/Backup</h3>
                <p style="margin-bottom: 1.5rem; color: var(--subtle);">
                    Spara en backup av all din data som JSON-fil.
                </p>
                <button onclick="exportData()" class="btn btn-secondary">Exportera all data</button>
            </div>

            <div class="pattern-list" style="margin-top: 2rem;">
                <h3>Importera Data</h3>
                <p style="margin-bottom: 1rem; color: var(--subtle);">
                    √Öterst√§ll fr√•n backup eller migrera fr√•n gammal version.
                </p>
                <div class="form-group">
                    <label for="importData">Klistra in JSON-data</label>
                    <textarea id="importData" rows="5" placeholder='[{"id":123,"date":"2025-02-07",...}]'></textarea>
                </div>
                <button onclick="importData()" class="btn">Importera Data</button>
                <div id="importMessage" class="success-message hidden" style="margin-top: 1rem;"></div>
            </div>
        </section>
    </div>

    <script>
        // Global state
        let currentRecording = null;
        let recognition = null;
        let weightChart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            initVoiceRecognition();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('weight').addEventListener('input', updateWeightStatus);
            updateMotivationDashboard();
            initTeknikbank();
        });

        // Voice Recognition
        function initVoiceRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                recognition.lang = 'sv-SE';
                recognition.continuous = true;
                recognition.interimResults = true;

                recognition.onresult = (event) => {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript + ' ';
                        }
                    }
                    if (currentRecording && finalTranscript) {
                        const field = document.getElementById(currentRecording);
                        field.value = (field.value + ' ' + finalTranscript).trim();
                    }
                };

                recognition.onerror = () => stopVoice();
                recognition.onend = () => {
                    if (currentRecording) {
                        const btn = document.querySelector(`button[onclick="startVoice('${currentRecording}')"]`);
                        if (btn) btn.classList.remove('recording');
                        currentRecording = null;
                    }
                };
            }
        }

        function startVoice(fieldId) {
            if (!recognition) {
                alert('R√∂stinspelning st√∂ds inte i din webbl√§sare. Prova Chrome eller Edge.');
                return;
            }
            if (currentRecording === fieldId) {
                stopVoice();
                return;
            }
            if (currentRecording) stopVoice();
            
            currentRecording = fieldId;
            const btn = document.querySelector(`button[onclick="startVoice('${fieldId}')"]`);
            btn.classList.add('recording');
            recognition.start();
        }

        function stopVoice() {
            if (recognition && currentRecording) {
                recognition.stop();
                const btn = document.querySelector(`button[onclick="startVoice('${currentRecording}')"]`);
                if (btn) btn.classList.remove('recording');
                currentRecording = null;
            }
        }

        // Teknikbank Functions
        function initTeknikbank() {
            // Pre-populate with existing tips if not already done
            const tips = JSON.parse(localStorage.getItem('bjjTips') || '[]');
            if (tips.length === 0) {
                const preTips = [
                    { id: Date.now() + 1, title: "Danaher - Position f√∂re Submission", content: "Spendera 80% av din tid p√• att f√∂rb√§ttra position, bara 20% p√• att attackera submissions. Nyb√∂rjare g√∂r tv√§rtom - de jagar submissions fr√•n d√•liga positioner och blir reversed. S√§kra dominant position f√∂rst, d√• blir submissions enkla och l√•g-risk.", category: "general", favorite: true, date: "2024-10-01" },
                    { id: Date.now() + 2, title: "Danaher - Mekanik sl√•r Styrka", content: "F√∂rs√∂k aldrig √∂vervinna styrka med styrka. Bryt den mekaniska strukturen ist√§llet. Om n√•gon har starkt grepp, dra inte emot det - flytta kroppen f√∂r att skapa en vinkel d√§r deras grepp blir svagt. Mekanik sl√•r alltid styrka.", category: "general", favorite: true, date: "2024-10-01" },
                    { id: Date.now() + 3, title: "Danaher - Fr√•gemetoden", content: "Varje drag i BJJ √§r ett svar p√• en fr√•ga. N√§r du k√∂rt fast, fr√•ga: Vad f√∂rs√∂ker MOTST√ÖNDAREN √•stadkomma? Vad √§r de r√§dda f√∂r? Neka dem d√• vad de vill ha och ge dem vad de fruktar. Denna enkla metod l√∂ser de flesta taktiska problem.", category: "general", favorite: true, date: "2024-10-01" },
                    { id: Date.now() + 4, title: "Danaher - G√• in p√• Reaktionen", content: "G√• aldrig in i submissions n√§r motst√•ndaren √§r statisk och redo. V√§nta p√• att de r√∂r sig eller reagerar, g√• d√• in under deras r√∂relse. N√§r de pushar, dra dem. N√§r de drar, pusha dem. G√• in i alla submissions p√• deras reaktion, inte deras f√∂rberedelse.", category: "submission", favorite: true, date: "2024-10-01" },
                    { id: Date.now() + 5, title: "Danaher - Kontrollera Inside Space", content: "I toppposition, kontrollera inside space mellan dig och motst√•ndaren. H√•ll dina armb√•gar innanf√∂r deras. I bottenposition, k√§mpa f√∂r att f√• DINA armb√•gar innanf√∂r. Den som kontrollerar inside space kontrollerar positionen. Detta √§r den fundamentala kampen i alla pin escapes.", category: "general", favorite: true, date: "2024-10-01" },
                    { id: Date.now() + 6, title: "Danaher - Frames √§r Tillf√§lliga", content: "Frames √§r inte menade att h√•lla f√∂r evigt. De k√∂per dig TID att escapa. N√§r du framar, b√∂rja omedelbart r√∂ra dina h√∂fter. Framen skapar bara utrymmet - din h√∂ftr√∂relse √§r vad som faktiskt escapar. Aldrig frama och sluta r√∂ra dig.", category: "escape", favorite: true, date: "2024-10-07" },
                    { id: Date.now() + 7, title: "Danaher - Tv√• Typer av Kontroll", content: "Det finns bara tv√• typer av kontroll i BJJ: 1) Pinna dem mot mattan (side control, mount) eller 2) Pinna dem mot din kropp (back control, front headlock). F√∂rst√• vilken typ du har, och vilka verktyg som funkar f√∂r varje typ. Blanda inte strategier.", category: "general", favorite: true, date: "2024-10-07" },
                    { id: Date.now() + 8, title: "Danaher - M√∂t Yngre/Starkare", content: "Hur m√∂ta en som √§r yngre och starkare: L√•t dem tr√∂tta ut sig. √Ñven om de √§r starkare, l√•t dem jobba fyra g√•nger h√•rdare √§n dig. H√•ll fast, pin points. L√•t dem slita ut sig.", category: "general", favorite: true, date: "2024-09-30" },
                    { id: Date.now() + 9, title: "Marcelo - Arm Drag √§r Allt", content: "Arm drag √§r min favoritteknik eftersom den funkar √∂verallt: st√•ende, sittande guard, butterfly, half guard. Det √§r en teknik som l√∂ser m√•nga problem. Bem√§stra arm drag och du har ett universellt verktyg som skapar back takes och sweeps fr√•n vilken position som helst.", category: "general", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 10, title: "Marcelo - Guillotine fr√•n Guard", content: "F√∂r guillotine fr√•n guard: Ta inte bara tag i nacken. Anv√§nd f√∂rst dina ben f√∂r att off-balance dem fram√•t. N√§r de postar h√§nderna, D√Ö tar du guillotine. Setup √§r viktigare √§n finish. Om de √§r balanserade funkar inte choken.", category: "submission", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 11, title: "Marcelo - Butterfly Guard Filosofi", content: "Butterfly guard handlar om konstant r√∂relse och vinklar. Var aldrig statisk. Om de trycker fram√•t, kom upp p√• underhook. Om de sitter tillbaka, scoot fram√•t och elevera. Om de g√•r sidledes, f√∂lj med hooken. T√§nk som vatten - alltid fl√∂dande, aldrig fast.", category: "guard", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 12, title: "Marcelo - Float Pass Konceptet", content: "N√§r du passar, committa inte din vikt f√∂rr√§n du s√§krat positionen. Flyta din vikt, h√•ll dig mobil, tills du ser √∂ppningen. D√• droppar du vikten p√• en g√•ng. F√∂r m√•nga committar vikten tidigt och blir sweepad. H√•ll dig l√§tt, h√•ll dig mobil.", category: "passing", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 13, title: "Marcelo - Tr√§na med Syfte", content: "Rulla inte bara f√∂r att rulla. V√§lj en sak f√∂re varje runda: 'Idag spelar jag bara butterfly guard' eller 'Idag tar jag bara guillotines.' Om du f√∂rlorar position, det √§r okej - du l√§r dig den specifika saken. Specifik tr√§ning skapar specifika f√§rdigheter.", category: "general", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 14, title: "Marcelo - Tryck vs Connection", content: "Stor skillnad mellan tryck och connection. Tryck √§r att pusha ner med vikt. Connection √§r att stanna fastkopplad medan du √§r mobil. I toppposition, beh√•ll connection, inte bara tryck. Detta l√•ter dig f√∂lja deras r√∂relser och f√∂rhindra escapes medan du √§r offensiv.", category: "general", favorite: true, date: "2024-10-05" },
                    { id: Date.now() + 15, title: "Marcelo - N√§r Sitta till Guard", content: "Sitt bara till guard om du har grepp f√∂rst. St√•ende utan grepp √§r b√§ttre √§n sittande utan grepp. Om de inte engagerar, stanna st√•ende och f√• dem komma till dig. Att sitta utan kontroll ger bort toppposition gratis.", category: "guard", favorite: true, date: "2024-10-07" },
                    { id: Date.now() + 16, title: "Back Take - Hooks innan attack", content: "V√§nta tills motst√•ndaren h√∂ften droppar till mattan INNAN du b√∂rjar s√§tta hooks. D√• f√•r du mycket b√§ttre kontroll.", category: "back", favorite: true, date: "2024-09-01" },
                    { id: Date.now() + 17, title: "Half Guard - Spine p√• mattan", content: "F√∂rs√∂k inte etablera pass s√•vida inte motst√•ndaren ryggrad √§r p√• mattan. Detta f√∂rhindrar att du fastnar i half guard.", category: "passing", favorite: true, date: "2024-09-01" },
                    { id: Date.now() + 18, title: "Mount - Bottenperson m√•l", content: "Bottenperson vinner om de f√•r h√∂ften framf√∂r toppersonen och etablerar 2 connections p√• h√∂ft/kn√§ (3 sek eller mer).", category: "mount", favorite: false, date: "2024-09-01" },
                    { id: Date.now() + 19, title: "Strypning fr√•n Back - Vilken arm kontrollerar?", content: "T√§nk p√• vilken arm som stryper och vilken som kontrollerar axeln. Ta armen upp sen till v√§nster och skapa utrymme, snurra runt s√• du hamnar magen mot.", category: "escape", favorite: true, date: "2024-09-15" },
                    { id: Date.now() + 20, title: "Guard - Lyft h√∂ften, h√§lar ned√•t", content: "Viktigt att du lyfter p√• rumpan och att h√§larna pekas ner n√§r du jobbar fr√•n guard.", category: "guard", favorite: false, date: "2024-09-15" },
                    { id: Date.now() + 21, title: "Greppbrytning - Korsa och tryck", content: "Bryt grepp: korsa din hand, tryck upp, dra den sen √∂ver hans mitt. H√•ll tryck. V√§lj sen ta rygg eller stryp med benen.", category: "guard", favorite: true, date: "2024-09-15" },
                    { id: Date.now() + 22, title: "Mount Escape - H√§nder p√• h√∂ft", content: "Om du √§r under: l√§gg b√•da h√§nderna p√• h√∂ften och tryck dig ut. Rocka ut ett ben och re-guard.", category: "escape", favorite: true, date: "2024-09-15" },
                    { id: Date.now() + 23, title: "North South - R√∂relse √§r nyckeln", content: "North south sv√•rt att plocka benen ifr√•n. G√• fram och tillbaka, √§ven g√• √∂ver magen till andra sidan.", category: "side-control", favorite: false, date: "2024-09-15" },
                    { id: Date.now() + 24, title: "Mental approach - Var inte girig", content: "Var inte girig, ta det lugnt och inv√§nta r√§tt tillf√§lle. Jag f√∂rs√∂kte mounta f√∂r tidigt.", category: "general", favorite: true, date: "2024-09-15" },
                    { id: Date.now() + 25, title: "Side Control - Handposition", content: "N√§r du ligger i side: ist√§llet f√∂r att koppla ihop h√§nderna, ta handen under huvudet och h√•ll i sidan av halsen. Andra handen f√•ngar andra armen samt kn√§t stoppar h√∂ften (som en halv knee on belly).", category: "side-control", favorite: true, date: "2024-09-15" },
                    { id: Date.now() + 26, title: "Side Control - Var tung mitt p√•", content: "T√§nk p√• att vara tung mitt p√•, t√§nk som en pelare som g√•r igenom dig. Ta inte st√∂d med h√§nderna d√• f√∂rdelar du vikten fel.", category: "side-control", favorite: false, date: "2024-09-15" },
                    { id: Date.now() + 27, title: "Dummy Sweep fr√•n Guard", content: "Om n√•gon st√•r i min guard: greppa baksidan av f√∂tterna och f√§ll bak√•t.", category: "sweep", favorite: false, date: "2024-09-20" },
                    { id: Date.now() + 28, title: "Back Control - Grepp i jackan", content: "Om du hamnar p√• rygg p√• den andra: greppa EJ runt halsen, ta tag i jackan bak. V√§nta p√• √∂ppning med f√∂tterna, kroka i och ta d√• grepp under armen och halsen och fall √•t h√•llet foten har krok.", category: "back", favorite: true, date: "2024-09-20" },
                    { id: Date.now() + 29, title: "Americana fr√•n Side - Dra mot h√∂ft", content: "Hamnade i side och fick tag i armen, gjorde americana. Se till att dra den ned√•t mot h√∂ften.", category: "submission", favorite: false, date: "2024-09-20" },
                    { id: Date.now() + 30, title: "Mental - Andas lugnt p√• topp", content: "N√§r du ligger p√•: den andra har jobbigt. Andas lugnt, √•terh√§mta dig en stund. Den andra blir stressad om du andas lugnt. Fl√•sa inte h√§r - det √§r nu du ska √•terh√§mta dig.", category: "general", favorite: true, date: "2024-09-20" },
                    { id: Date.now() + 31, title: "Guard Retention - G√∂r n√•got efter!", content: "Vi √∂vade guard retention. Viktigt: eftersom du jobbar s√• h√•rt h√§r, n√§r du v√§l lyckas s√• G√ñR N√ÖGOT D√Ö. Annars blir du slut. Du har nu f√•tt n√•got f√∂r m√∂dan - l√•t inte den andra smita iv√§g igen.", category: "guard", favorite: true, date: "2024-09-20" },
                    { id: Date.now() + 32, title: "Push-Pull Princip", content: "Push Pull - teknik som funkar i alla l√§gen. Om jag drar lite och han g√∂r motst√•nd: f√∂lj √•t hans h√•ll. √Ñven i guardpassing: dra kn√§na √•t v√§nster, han g√∂r motst√•nd, dra dem √•t hans h√•ll.", category: "general", favorite: true, date: "2024-09-25" },
                    { id: Date.now() + 33, title: "Guard Passing - Tryck upp f√∂tterna", content: "Hur man kommer f√∂rbi guard: Tryck upp f√∂tterna, ta tag under vaderna och tryck de l√§ngst bak. Eller g√• rund nord vid huvudet och l√§gg dig p√• honom.", category: "passing", favorite: false, date: "2024-09-25" },
                    { id: Date.now() + 34, title: "Mental - G√• p√• instinkt", content: "Ett misstag m√•nga g√∂r √§r att man t√§nker f√∂r mycket p√• vad man ska g√∂ra och d√• missar man √∂gonblicket. Ist√§llet: g√• p√• instinkt. Efter ett tag kommer hj√§rnan komma p√• √∂vningarna du gjort.", category: "general", favorite: true, date: "2024-09-25" },
                    { id: Date.now() + 35, title: "Attack - √ñverraskning √§r b√§st", content: "√ñverraskning √§r den b√§sta attacken i jiu jitsu. Slappna av innan du g√∂r attacken, d√• g√•r du fr√•n 0 till hundra. Ist√§llet f√∂r att f√∂rs√∂ka kontrollera med 60% sen upp till 100% - blir inte lika mycket √∂verraskning.", category: "general", favorite: true, date: "2024-09-25" },
                    { id: Date.now() + 36, title: "Guard - H√•ll avst√•nd f√∂r leverage", content: "Om du har guard: f√∂rs√∂k h√•ll avst√•nd. Ju l√§ngre avst√•nd ju mer kraft f√∂r dig. Mer leverage. Dra i kragen eller √§rmen. Skapa utrymme.", category: "guard", favorite: false, date: "2024-09-25" },
                    { id: Date.now() + 37, title: "I Guard - Skydda kragen", content: "Om jag √§r i guard: h√•ll mina h√§nder s√• att han inte kan ta tag i √∂vre delen av min krage. Skydda den delen. M√•let √§r att trycka upp mina ben s√• han ramlar fram. OM han f√•r tag i kragen: ta tag i hans krage √∂ver hans arm - d√• f√•r du √∂vertag.", category: "passing", favorite: false, date: "2024-09-25" },
                    { id: Date.now() + 38, title: "North South Strangle - Armb√•gsposition", content: "North south strangle: N√§r du v√§l kommit fr√•n sidemount upp till north south - se till att vara utanf√∂r motst√•ndarens armb√•ge.", category: "submission", favorite: false, date: "2024-09-30" }
                ];
                localStorage.setItem('bjjTips', JSON.stringify(preTips));
            }

            // Event listeners
            document.getElementById('tipForm')?.addEventListener('submit', handleTipSubmit);
            document.getElementById('tipSearch')?.addEventListener('input', filterTips);
            document.getElementById('tipFilter')?.addEventListener('change', filterTips);
        }

        function handleTipSubmit(e) {
            e.preventDefault();
            
            const tip = {
                id: Date.now(),
                title: document.getElementById('tipTitle').value,
                content: document.getElementById('tipContent').value,
                category: document.getElementById('tipCategory').value,
                favorite: document.getElementById('tipFavorite').checked,
                date: new Date().toISOString().split('T')[0]
            };

            let tips = JSON.parse(localStorage.getItem('bjjTips') || '[]');
            tips.unshift(tip);
            localStorage.setItem('bjjTips', JSON.stringify(tips));

            document.getElementById('tipForm').reset();
            loadTips();
            
            const form = document.getElementById('tipForm');
            const success = document.createElement('div');
            success.className = 'success-message';
            success.textContent = 'Tips sparat! üéØ';
            form.parentNode.insertBefore(success, form);
            setTimeout(() => success.remove(), 3000);
        }

        function loadTips() {
            const tips = JSON.parse(localStorage.getItem('bjjTips') || '[]');
            const searchTerm = document.getElementById('tipSearch')?.value.toLowerCase() || '';
            const filter = document.getElementById('tipFilter')?.value || 'all';

            let filtered = tips.filter(tip => {
                const matchesSearch = tip.title.toLowerCase().includes(searchTerm) || 
                                    tip.content.toLowerCase().includes(searchTerm);
                const matchesFilter = filter === 'all' || 
                                    (filter === 'favorites' && tip.favorite) || 
                                    tip.category === filter;
                return matchesSearch && matchesFilter;
            });

            const container = document.getElementById('tipsList');
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Inga tips hittades</h3>
                        <p>Prova en annan s√∂kning eller filter.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(tip => `
                <div class="entry-card">
                    <div class="entry-header">
                        <div>
                            <span style="font-size: 1.2rem; font-weight: 600;">${tip.favorite ? '‚≠ê ' : ''}${tip.title}</span>
                        </div>
                        <div class="entry-meta">
                            <span class="entry-coach" style="background: var(--paper); padding: 0.3rem 0.6rem;">${getCategoryLabel(tip.category)}</span>
                            <span class="entry-date" style="font-size: 0.85rem;">${formatDate(tip.date)}</span>
                        </div>
                    </div>
                    <div class="entry-content">
                        <p>${tip.content}</p>
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="delete-btn" onclick="toggleFavorite(${tip.id})" style="flex: 0;">
                            ${tip.favorite ? 'Ta bort ‚≠ê' : 'L√§gg till ‚≠ê'}
                        </button>
                        <button class="delete-btn" onclick="deleteTip(${tip.id})">Radera</button>
                    </div>
                </div>
            `).join('');
        }

        function filterTips() {
            loadTips();
        }

        function toggleFavorite(id) {
            let tips = JSON.parse(localStorage.getItem('bjjTips') || '[]');
            const tip = tips.find(t => t.id === id);
            if (tip) {
                tip.favorite = !tip.favorite;
                localStorage.setItem('bjjTips', JSON.stringify(tips));
                loadTips();
            }
        }

        function deleteTip(id) {
            if (!confirm('√Ñr du s√§ker p√• att du vill radera detta tips?')) return;
            
            let tips = JSON.parse(localStorage.getItem('bjjTips') || '[]');
            tips = tips.filter(t => t.id !== id);
            localStorage.setItem('bjjTips', JSON.stringify(tips));
            loadTips();
        }

        function getCategoryLabel(category) {
            const labels = {
                'guard': 'Guard',
                'passing': 'Passing',
                'mount': 'Mount',
                'side-control': 'Side Control',
                'back': 'Back',
                'escape': 'Escapes',
                'submission': 'Submissions',
                'sweep': 'Sweeps',
                'takedown': 'Takedowns',
                'general': 'Allm√§nt'
            };
            return labels[category] || category;
        }

        function updateMotivationDashboard() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            const totalSessions = entries.length;
            
            // Calculate sessions this week
            const now = new Date();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - now.getDay() + 1); // Monday
            startOfWeek.setHours(0, 0, 0, 0);
            
            const thisWeek = entries.filter(e => {
                const entryDate = new Date(e.date);
                return entryDate >= startOfWeek;
            }).length;

            let message = '';
            let emoji = '';

            // Messages based on weekly frequency
            if (thisWeek === 0) {
                emoji = 'ü•ã';
                message = totalSessions === 0 
                    ? 'V√§lkommen! Logga ditt f√∂rsta pass efter tr√§ningen idag.'
                    : 'Dags att komma tillbaka p√• mattan! Din resa forts√§tter.';
            } else if (thisWeek === 1) {
                emoji = 'üí™';
                message = 'Bra start p√• veckan! Ett pass loggat. Forts√§tt bygga momentum.';
            } else if (thisWeek === 2) {
                emoji = 'üî•';
                message = 'Tv√• pass denna vecka! Du bygger goda vanor. Keep it up!';
            } else if (thisWeek === 3) {
                emoji = '‚ö°';
                message = 'Tre pass! Du √§r p√• r√§tt v√§g. Konsistens √§r nyckeln till framg√•ng.';
            } else if (thisWeek === 4) {
                emoji = 'üèÜ';
                message = 'Fyra pass denna vecka! Imponerande dedikation. Du utvecklas snabbt!';
            } else if (thisWeek >= 5) {
                emoji = 'üîù';
                message = `${thisWeek} pass! Du k√∂r h√•rt! Kom ih√•g att vila √§r ocks√• tr√§ning.`;
            }

            // Special messages for milestones
            if (totalSessions === 10) {
                emoji = 'üéØ';
                message = '10 pass klarat! Du b√∂rjar bygga riktiga vanor. Forts√§tt!';
            } else if (totalSessions === 25) {
                emoji = 'üåü';
                message = '25 pass i boken! Ditt A-spel b√∂rjar ta form. Snart bl√•tt b√§lte!';
            } else if (totalSessions === 50) {
                emoji = 'üíé';
                message = '50 pass! Halvv√§gs till bl√•tt b√§lte. Din progression √§r tydlig!';
            } else if (totalSessions === 100) {
                emoji = 'üëë';
                message = '100 PASS! Otrolig dedikation. Du √§r inte l√§ngre nyb√∂rjare!';
            } else if (totalSessions >= 150) {
                emoji = 'ü•∑';
                message = `${totalSessions} pass! Du √§r en veteran. Forts√§tt inspirera andra!`;
            }

            const dashboard = document.getElementById('motivationDashboard');
            dashboard.innerHTML = `
                <div class="motivation-dashboard">
                    <div class="motivation-stats">
                        <div class="big-number">${totalSessions}</div>
                        <div class="stat-label">Totalt Pass</div>
                        <div style="margin-top: 1rem; font-size: 1.5rem; opacity: 0.9;">
                            ${thisWeek} denna vecka
                        </div>
                    </div>
                    <div class="motivation-message">
                        <h3><span class="emoji">${emoji}</span> ${thisWeek === 0 && totalSessions === 0 ? 'V√§lkommen!' : 'Forts√§tt k√§mpa!'}</h3>
                        <p>${message}</p>
                    </div>
                </div>
            `;
        }

        // Weight Status
        function updateWeightStatus() {
            const weight = parseFloat(document.getElementById('weight').value);
            const statusDiv = document.getElementById('weightStatus');
            
            if (!weight) {
                statusDiv.innerHTML = '';
                return;
            }

            const TARGET = 82.3;
            const diff = TARGET - weight;
            
            let statusClass = 'good';
            let statusText = `${diff.toFixed(1)} kg marginal`;
            
            if (weight > TARGET) {
                statusClass = 'danger';
                statusText = `${Math.abs(diff).toFixed(1)} kg √∂ver gr√§ns!`;
            } else if (weight > TARGET - 1) {
                statusClass = 'warning';
                statusText = `${diff.toFixed(1)} kg marginal (n√§ra gr√§nsen)`;
            }
            
            statusDiv.innerHTML = `<span class="weight-status ${statusClass}">${statusText}</span>`;
        }

        // Form Submission
        document.getElementById('logForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const entry = {
                id: Date.now(),
                date: document.getElementById('date').value,
                coach: document.getElementById('coach').value,
                weight: document.getElementById('weight').value,
                technique: document.getElementById('technique').value,
                rolls: document.getElementById('rolls').value,
                positions: document.getElementById('positions').value,
                worked: document.getElementById('worked').value,
                stuck: document.getElementById('stuck').value,
                good: document.getElementById('good').value,
                improve: document.getElementById('improve').value
            };

            let entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            entries.push(entry);
            localStorage.setItem('bjjEntries', JSON.stringify(entries));

            showLogSuccess('Pass sparat! ü•ã');
            updateMotivationDashboard(); // Update motivation after saving
            document.getElementById('logForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            document.getElementById('weightStatus').innerHTML = '';
        });

        function showLogSuccess(message) {
            const msgDiv = document.getElementById('logMessage');
            msgDiv.textContent = message;
            msgDiv.classList.remove('hidden');
            setTimeout(() => msgDiv.classList.add('hidden'), 3000);
        }

        // Navigation
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(sectionId).classList.add('active');
            event.target.classList.add('active');

            if (sectionId === 'entries') loadEntries();
            if (sectionId === 'teknikbank') loadTips();
            if (sectionId === 'roadmap') {} // Static content, no loading needed
            if (sectionId === 'weight') loadWeightTracking();
            if (sectionId === 'weekly') loadWeeklySummary();
            if (sectionId === 'analysis') loadAnalysis();
            if (sectionId === 'agame') loadAGame();
        }

        // Load Entries
        function loadEntries() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            const container = document.getElementById('entriesList');
            
            if (entries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Inga pass loggade √§nnu</h3>
                        <p>B√∂rja logga dina tr√§ningspass f√∂r att se dem h√§r.</p>
                    </div>
                `;
                return;
            }

            entries.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            container.innerHTML = entries.map(entry => `
                <div class="entry-card">
                    <div class="entry-header">
                        <div class="entry-date">${formatDate(entry.date)}</div>
                        <div class="entry-meta">
                            ${entry.coach ? `<div class="entry-coach">Coach: ${entry.coach}</div>` : ''}
                            ${entry.weight ? `<div class="entry-weight">${entry.weight} kg</div>` : ''}
                        </div>
                    </div>
                    <div class="entry-content">
                        ${entry.technique ? `<h4>Teknik</h4><p>${entry.technique}</p>` : ''}
                        ${entry.rolls ? `<h4>Rullar</h4><p>${entry.rolls}</p>` : ''}
                        ${entry.positions ? `<h4>Positioner</h4><p>${entry.positions}</p>` : ''}
                        ${entry.worked ? `<h4>Fungerade</h4><p>${entry.worked}</p>` : ''}
                        ${entry.stuck ? `<h4>Fungerade inte</h4><p>${entry.stuck}</p>` : ''}
                        ${entry.good ? `<h4>‚úÖ Bra</h4><p>${entry.good}</p>` : ''}
                        ${entry.improve ? `<h4>üéØ F√∂rb√§ttra</h4><p>${entry.improve}</p>` : ''}
                    </div>
                    <button class="delete-btn" onclick="deleteEntry(${entry.id})">Radera</button>
                </div>
            `).join('');
        }

        function deleteEntry(id) {
            if (!confirm('√Ñr du s√§ker p√• att du vill radera detta pass?')) return;
            
            let entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            entries = entries.filter(e => e.id !== id);
            localStorage.setItem('bjjEntries', JSON.stringify(entries));
            loadEntries();
        }

        // Weekly Summary
        function loadWeeklySummary() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            
            if (entries.length === 0) {
                document.getElementById('weeklyContent').innerHTML = `
                    <div class="empty-state">
                        <h3>Ingen data √§nnu</h3>
                        <p>B√∂rja logga pass f√∂r att se veckosammanfattningar.</p>
                    </div>
                `;
                return;
            }

            if (entries.length < 3) {
                document.getElementById('weeklyContent').innerHTML = `
                    <div class="empty-state">
                        <h3>F√∂r lite data √§nnu</h3>
                        <p>Du har ${entries.length} pass loggat. Logga minst 3 pass f√∂r att f√• meningsfulla veckosammanfattningar.</p>
                        <p style="margin-top: 1rem; color: var(--accent);">Forts√§tt tr√§na och logga - varje pass ger b√§ttre insikter! üí™</p>
                    </div>
                `;
                return;
            }

            // Group entries by week
            const weeks = {};
            entries.forEach(entry => {
                const date = new Date(entry.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay() + 1); // Monday
                weekStart.setHours(0, 0, 0, 0);
                const weekKey = weekStart.toISOString().split('T')[0];
                
                if (!weeks[weekKey]) {
                    weeks[weekKey] = [];
                }
                weeks[weekKey].push(entry);
            });

            // Sort weeks (newest first)
            const sortedWeeks = Object.entries(weeks).sort((a, b) => 
                new Date(b[0]) - new Date(a[0])
            );

            let html = '';

            sortedWeeks.slice(0, 8).forEach(([weekStart, weekEntries]) => {
                const startDate = new Date(weekStart);
                const endDate = new Date(weekStart);
                endDate.setDate(startDate.getDate() + 6);
                
                // Calculate stats for the week
                const sessionsCount = weekEntries.length;
                const weights = weekEntries.filter(e => e.weight).map(e => parseFloat(e.weight));
                const avgWeight = weights.length > 0 
                    ? (weights.reduce((a, b) => a + b) / weights.length).toFixed(1)
                    : null;
                
                // Extract patterns for the week
                const positions = extractPatterns(weekEntries, 'positions').slice(0, 3);
                const worked = extractPatterns(weekEntries, 'worked').slice(0, 3);
                const stuck = extractPatterns(weekEntries, 'stuck').slice(0, 3);
                
                // Coach frequency
                const coaches = {};
                weekEntries.forEach(e => {
                    if (e.coach) {
                        coaches[e.coach] = (coaches[e.coach] || 0) + 1;
                    }
                });
                const topCoach = Object.entries(coaches).sort((a, b) => b[1] - a[1])[0];

                html += `
                    <div class="pattern-list" style="margin-bottom: 2rem;">
                        <h3>Vecka ${formatDateRange(startDate, endDate)}</h3>
                        
                        <div class="stats-grid" style="margin: 1.5rem 0;">
                            <div class="stat-card">
                                <div class="stat-number">${sessionsCount}</div>
                                <div class="stat-label">Pass</div>
                            </div>
                            ${avgWeight ? `
                                <div class="stat-card">
                                    <div class="stat-number">${avgWeight}</div>
                                    <div class="stat-label">Snitt vikt (kg)</div>
                                </div>
                            ` : ''}
                            ${topCoach ? `
                                <div class="stat-card">
                                    <div class="stat-number" style="font-size: 1.5rem;">${topCoach[0]}</div>
                                    <div class="stat-label">Fr√§msta coach</div>
                                </div>
                            ` : ''}
                        </div>

                        ${positions.length > 0 ? `
                            <div style="margin: 1rem 0;">
                                <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--subtle);">Mest f√∂rekommande positioner:</h4>
                                <p style="color: var(--ink);">${positions.map(([p, c]) => `${p} (${c}x)`).join(', ')}</p>
                            </div>
                        ` : ''}

                        ${worked.length > 0 ? `
                            <div style="margin: 1rem 0;">
                                <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--success);">‚úÖ Vad som fungerade:</h4>
                                <p style="color: var(--ink);">${worked.map(([p, c]) => `${p} (${c}x)`).join(', ')}</p>
                            </div>
                        ` : ''}

                        ${stuck.length > 0 ? `
                            <div style="margin: 1rem 0;">
                                <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem; color: var(--warning);">‚ö†Ô∏è Vad som inte fungerade:</h4>
                                <p style="color: var(--ink);">${stuck.map(([p, c]) => `${p} (${c}x)`).join(', ')}</p>
                            </div>
                        ` : ''}

                        ${generateWeeklyInsight(weekEntries, sessionsCount, positions, worked, stuck)}
                    </div>
                `;
            });

            document.getElementById('weeklyContent').innerHTML = html;
        }

        function generateWeeklyInsight(entries, count, positions, worked, stuck) {
            let insight = '';
            
            if (count >= 5) {
                insight = 'üî• Exceptionell vecka! Du k√∂r h√•rt och bygger extremt god momentum.';
            } else if (count >= 4) {
                insight = 'üí™ Stark vecka! Du √§r konsistent och din utveckling accelererar.';
            } else if (count >= 3) {
                insight = '‚úÖ Solid vecka! Tre pass √§r en utm√§rkt bas f√∂r progression.';
            } else if (count === 2) {
                insight = 'üëç Bra start! Tv√• pass h√•ller dig aktiv. Sikta p√• ett till n√§sta vecka.';
            } else {
                insight = '‚ö° Ett pass √§r b√§ttre √§n noll! Sikta p√• fler n√§sta vecka.';
            }

            // Add specific insight if patterns are clear
            if (worked.length > 0 && stuck.length > 0) {
                const topWorked = worked[0][0];
                const topStuck = stuck[0][0];
                insight += ` Fokusera p√• att utveckla "${topWorked}" vidare, och jobba extra p√• "${topStuck}".`;
            } else if (worked.length > 0) {
                insight += ` Din "${worked[0][0]}" utvecklas bra - forts√§tt d√§r!`;
            }

            return `
                <div style="margin-top: 1.5rem; padding: 1rem; background: var(--paper); border-left: 3px solid var(--accent);">
                    <p style="font-style: italic; color: var(--subtle); margin: 0;">
                        ${insight}
                    </p>
                </div>
            `;
        }

        function formatDateRange(start, end) {
            const startStr = start.toLocaleDateString('sv-SE', { month: 'short', day: 'numeric' });
            const endStr = end.toLocaleDateString('sv-SE', { month: 'short', day: 'numeric' });
            return `${startStr} - ${endStr}`;
        }

        // Weight Tracking
        function loadWeightTracking() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]')
                .filter(e => e.weight && e.weight.toString().trim() !== '')
                .sort((a, b) => new Date(a.date) - new Date(b.date));

            const container = document.getElementById('weightStats');
            if (!container) return;

            if (entries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <h3>Ingen viktdata √§nnu</h3>
                        <p>B√∂rja logga din vikt i varje pass f√∂r att se utveckling.</p>
                    </div>
                `;
                return;
            }

            // Chart
            const ctx = document.getElementById('weightChart');
            if (!ctx) return;
            
            if (weightChart) weightChart.destroy();

            weightChart = new Chart(ctx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: entries.map(e => formatDateShort(e.date)),
                    datasets: [{
                        label: 'Vikt (kg)',
                        data: entries.map(e => parseFloat(e.weight)),
                        borderColor: '#c44536',
                        backgroundColor: 'rgba(196, 69, 54, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'T√§vlingsgr√§ns (82.3 kg)',
                        data: Array(entries.length).fill(82.3),
                        borderColor: '#8b8680',
                        borderDash: [5, 5],
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: { legend: { display: true } },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 75,
                            max: 85
                        }
                    }
                }
            });

            // Stats
            const weights = entries.map(e => parseFloat(e.weight));
            const current = weights[weights.length - 1];
            const avg = weights.reduce((a, b) => a + b) / weights.length;
            const trend = weights.length > 1 ? weights[weights.length - 1] - weights[0] : 0;

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${current.toFixed(1)}</div>
                    <div class="stat-label">Senaste vikt (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${avg.toFixed(1)}</div>
                    <div class="stat-label">Genomsnitt (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${trend > 0 ? '+' : ''}${trend.toFixed(1)}</div>
                    <div class="stat-label">F√∂r√§ndring (kg)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${(82.3 - current).toFixed(1)}</div>
                    <div class="stat-label">Till gr√§ns (kg)</div>
                </div>
            `;
        }

        // Analysis
        function loadAnalysis() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            
            if (entries.length === 0) {
                document.getElementById('statsGrid').innerHTML = `
                    <div class="empty-state">
                        <h3>Ingen data att analysera √§nnu</h3>
                        <p>Logga minst 3-5 pass f√∂r att se m√∂nster och trender.</p>
                    </div>
                `;
                document.getElementById('patternsContainer').innerHTML = '';
                return;
            }

            // Calculate consistency metrics
            const totalSessions = entries.length;
            const last30Days = entries.filter(e => {
                const entryDate = new Date(e.date);
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                return entryDate >= thirtyDaysAgo;
            }).length;

            // Calculate current streak (week-based)
            const weeks = {};
            entries.forEach(entry => {
                const date = new Date(entry.date);
                const weekStart = new Date(date);
                weekStart.setDate(date.getDate() - date.getDay() + 1); // Monday
                weekStart.setHours(0, 0, 0, 0);
                const weekKey = weekStart.toISOString().split('T')[0];
                weeks[weekKey] = (weeks[weekKey] || 0) + 1;
            });

            const sortedWeekKeys = Object.keys(weeks).sort((a, b) => new Date(b) - new Date(a));
            let weekStreak = 0;
            let lastWeek = null;
            
            for (const weekKey of sortedWeekKeys) {
                const weekDate = new Date(weekKey);
                if (!lastWeek) {
                    lastWeek = weekDate;
                    weekStreak = 1;
                } else {
                    const weeksDiff = Math.floor((lastWeek - weekDate) / (1000 * 60 * 60 * 24 * 7));
                    if (weeksDiff === 1) { // Consecutive week
                        weekStreak++;
                        lastWeek = weekDate;
                    } else {
                        break;
                    }
                }
            }
            
            const totalPassesInStreak = sortedWeekKeys.slice(0, weekStreak)
                .reduce((sum, weekKey) => sum + weeks[weekKey], 0);

            const sortedWeeks = Object.entries(weeks).sort((a, b) => 
                new Date(a[0]) - new Date(b[0])
            ).slice(-12); // Last 12 weeks

            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${totalSessions}</div>
                    <div class="stat-label">Totalt pass</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${last30Days}</div>
                    <div class="stat-label">Senaste 30 dagarna</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${Math.round(last30Days / 4.3)}</div>
                    <div class="stat-label">Pass/vecka (snitt)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${weekStreak} ${weekStreak === 1 ? 'vecka' : 'veckor'}</div>
                    <div class="stat-label">Streak (${totalPassesInStreak} pass)</div>
                </div>
            `;

            // Consistency chart
            const consistencyHTML = sortedWeeks.length > 1 ? `
                <div class="chart-container" style="margin-bottom: 2rem;">
                    <h3>Konsistens (senaste 12 veckorna)</h3>
                    <div style="display: flex; gap: 1rem; margin-bottom: 1rem; flex-wrap: wrap; font-family: 'DM Mono', monospace; font-size: 0.75rem;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="width: 20px; height: 20px; background: #2d7a3e; display: inline-block;"></span>
                            5+ pass
                        </span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="width: 20px; height: 20px; background: #c44536; display: inline-block;"></span>
                            3-4 pass
                        </span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="width: 20px; height: 20px; background: #d97706; display: inline-block;"></span>
                            2 pass
                        </span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="width: 20px; height: 20px; background: #8b8680; display: inline-block;"></span>
                            1 pass
                        </span>
                    </div>
                    <canvas id="consistencyChart"></canvas>
                </div>
            ` : '';

            const positions = extractPatterns(entries, 'positions');
            const worked = extractPatterns(entries, 'worked');
            const stuck = extractPatterns(entries, 'stuck');

            document.getElementById('patternsContainer').innerHTML = `
                ${consistencyHTML}
                ${createPatternList('Vanligaste Positioner', positions)}
                ${createPatternList('Vad som Fungerar', worked)}
                ${createPatternList('Vad som Inte Fungerar', stuck)}
            `;

            // Draw consistency chart
            if (sortedWeeks.length > 1) {
                setTimeout(() => {
                    const ctx = document.getElementById('consistencyChart');
                    if (ctx) {
                        new Chart(ctx.getContext('2d'), {
                            type: 'bar',
                            data: {
                                labels: sortedWeeks.map(([date]) => {
                                    const d = new Date(date);
                                    return d.toLocaleDateString('sv-SE', { month: 'short', day: 'numeric' });
                                }),
                                datasets: [{
                                    label: 'Pass per vecka',
                                    data: sortedWeeks.map(([, count]) => count),
                                    backgroundColor: sortedWeeks.map(([, count]) => {
                                        if (count >= 5) return '#2d7a3e';
                                        if (count >= 3) return '#c44536';
                                        if (count >= 2) return '#d97706';
                                        return '#8b8680';
                                    }),
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                plugins: {
                                    legend: { display: false }
                                },
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: { stepSize: 1 }
                                    }
                                }
                            }
                        });
                    }
                }, 100);
            }
        }

        function extractPatterns(entries, field) {
            const phrases = {};
            
            // Common BJJ phrases to look for
            const bjjPhrases = [
                'closed guard', 'open guard', 'half guard', 'butterfly guard', 'spider guard',
                'mount escape', 'side control', 'back control', 'knee on belly',
                'guard retention', 'guard passing', 'guard recovery',
                'armbar', 'triangle', 'kimura', 'americana', 'guillotine', 'rear naked choke',
                'sweep', 'submission', 'takedown', 'scramble',
                'top position', 'bottom position',
                'hip escape', 'bridge', 'shrimp', 'technical standup',
                'grips', 'posture', 'pressure', 'base', 'frame'
            ];
            
            entries.forEach(entry => {
                if (!entry[field]) return;
                const text = entry[field].toLowerCase();
                
                // First, look for known BJJ phrases
                bjjPhrases.forEach(phrase => {
                    if (text.includes(phrase)) {
                        if (!phrases[phrase]) phrases[phrase] = 0;
                        phrases[phrase]++;
                    }
                });
                
                // Then extract 2-3 word phrases that appear multiple times
                const words = text.split(/\s+/);
                for (let i = 0; i < words.length - 1; i++) {
                    // Clean words
                    const w1 = words[i].replace(/[^\w]/g, '');
                    const w2 = words[i + 1].replace(/[^\w]/g, '');
                    
                    if (w1.length >= 3 && w2.length >= 3) {
                        const twoWord = `${w1} ${w2}`;
                        // Skip if it's already a known phrase
                        if (!bjjPhrases.includes(twoWord)) {
                            if (!phrases[twoWord]) phrases[twoWord] = 0;
                            phrases[twoWord]++;
                        }
                    }
                    
                    // 3-word phrases
                    if (i < words.length - 2) {
                        const w3 = words[i + 2].replace(/[^\w]/g, '');
                        if (w1.length >= 3 && w2.length >= 3 && w3.length >= 3) {
                            const threeWord = `${w1} ${w2} ${w3}`;
                            if (!bjjPhrases.includes(threeWord)) {
                                if (!phrases[threeWord]) phrases[threeWord] = 0;
                                phrases[threeWord]++;
                            }
                        }
                    }
                }
            });

            // Filter out phrases that only appear once and sort
            return Object.entries(phrases)
                .filter(([phrase, count]) => count >= 2) // Must appear at least twice
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
        }

        function createPatternList(title, patterns) {
            if (patterns.length === 0) return '';
            
            return `
                <div class="pattern-list">
                    <h3>${title}</h3>
                    ${patterns.map(([name, count]) => `
                        <div class="pattern-item">
                            <span class="pattern-name">${name}</span>
                            <span class="pattern-count">${count}x</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // A-Game
        function loadAGame() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            
            if (entries.length < 5) {
                document.getElementById('agameContent').innerHTML = `
                    <div class="empty-state">
                        <h3>F√∂r tidigt f√∂r A-spel</h3>
                        <p>Logga minst 5-8 pass f√∂rst s√• vi kan identifiera vad som faktiskt fungerar f√∂r dig.</p>
                        <p style="margin-top: 1rem; color: var(--ink);">Du har ${entries.length} pass loggade. Forts√§tt tr√§na!</p>
                    </div>
                `;
                return;
            }

            const worked = extractPatterns(entries, 'worked');
            const positions = extractPatterns(entries, 'positions');
            
            const topWorked = worked.slice(0, 5);
            const topPositions = positions.slice(0, 5);

            document.getElementById('agameContent').innerHTML = `
                <div class="agame-section">
                    <h3>Ditt framv√§xande A-spel</h3>
                    <p style="margin-bottom: 2rem; color: var(--subtle);">
                        Baserat p√• ${entries.length} loggade pass. Detta √§r vad som faktiskt fungerar f√∂r dig:
                    </p>

                    <div class="agame-position">
                        <h4>Positioner du √•terkommer till</h4>
                        <ul>
                            ${topPositions.map(([pos]) => `<li>${pos}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="agame-position">
                        <h4>Tekniker som fungerar</h4>
                        <ul>
                            ${topWorked.map(([tech]) => `<li>${tech}</li>`).join('')}
                        </ul>
                    </div>

                    <div class="agame-position">
                        <h4>N√§sta steg</h4>
                        <ul>
                            <li>Identifiera sekvenser mellan dina fungerande positioner</li>
                            <li>Bygg kedjor: position ‚Üí √∂verg√•ng ‚Üí submission/sweep</li>
                            <li>Dela din analys med din coach f√∂r skr√§ddarsydd feedback</li>
                        </ul>
                    </div>
                </div>

                <div style="margin-top: 2rem; padding: 1.5rem; background: var(--paper); border-left: 3px solid var(--accent);">
                    <p style="font-style: italic; color: var(--subtle);">
                        "A-spel bygger du inte p√• YouTube ‚Äì du bygger det p√• mattan, genom att notera vad som faktiskt fungerar f√∂r DIN kropp och DIN timing."
                    </p>
                </div>
            `;
        }

        // Export/Import
        function exportData() {
            const entries = JSON.parse(localStorage.getItem('bjjEntries') || '[]');
            
            if (entries.length === 0) {
                alert('Ingen data att exportera!');
                return;
            }

            const dataStr = JSON.stringify(entries, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rolling-journal-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const data = document.getElementById('importData').value;
            if (!data) {
                alert('Klistra in data f√∂rst!');
                return;
            }

            try {
                const entries = JSON.parse(data);
                localStorage.setItem('bjjEntries', JSON.stringify(entries));
                
                const msgDiv = document.getElementById('importMessage');
                msgDiv.textContent = `‚úÖ ${entries.length} pass importerade!`;
                msgDiv.classList.remove('hidden');
                document.getElementById('importData').value = '';
                
                setTimeout(() => msgDiv.classList.add('hidden'), 5000);
            } catch (e) {
                alert('Fel vid import: ' + e.message);
            }
        }

        // Utilities
        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('sv-SE', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatDateShort(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('sv-SE', { 
                month: 'short', 
                day: 'numeric' 
            });
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered'))
                    .catch(err => console.log('Service Worker registration failed'));
            });
        }
    </script>
</body>
</html>
